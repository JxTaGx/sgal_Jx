<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Actualizar Cultivo</title>
  <link rel="stylesheet" href="../css/pages/actualizar-cultivo-style.css">
</head>
<body>
  <div class="update-crop">
    <header class="update-crop__header">
      <img src="/frontend/IMG/logo-sena.png" alt="SENA Logo" class="update-crop__logo">
      <h1 class="update-crop__title">Actualizar Cultivo</h1>
    </header>

    <main class="update-crop__main">
      <div class="update-crop__content">
        <div class="update-crop__image-placeholder">
          <!-- decorativo -->
        </div>

        <form class="update-crop__form" id="formulario-actualizar-cultivo">
          <div class="update-crop__form-group update-crop__form-group--grid">
            <label for="nombreCultivo" class="update-crop__label">Nombre del cultivo</label>
            <input type="text" id="nombreCultivo" class="update-crop__input" required>
          </div>

          <div class="update-crop__form-group update-crop__form-group--grid">
            <label for="tipoCultivo" class="update-crop__label">Tipo cultivo</label>
            <input type="text" id="tipoCultivo" class="update-crop__input">
          </div>

          <div class="update-crop__form-group update-crop__form-group--grid">
            <label for="tamano" class="update-crop__label">Tama침o</label>
            <input type="text" id="tamano" class="update-crop__input">
          </div>

          <div class="update-crop__form-group update-crop__form-group--grid">
            <label for="ubicacion" class="update-crop__label">Ubicaci칩n</label>
            <input type="text" id="ubicacion" class="update-crop__input">
          </div>

          <div class="update-crop__form-group update-crop__form-group--grid">
            <label for="estado" class="update-crop__label">Estado</label>
            <input type="text" id="estado" class="update-crop__input">
          </div>

          <div class="update-crop__form-group update-crop__form-group--grid">
            <label for="descripcion" class="update-crop__label">Descripci칩n</label>
            <input type="text" id="descripcion" class="update-crop__input">
          </div>

          <div class="update-crop__form-group update-crop__form-group--grid">
            <label for="idCultivoMostrar" class="update-crop__label">ID</label>
            <input type="text" id="idCultivoMostrar" class="update-crop__input" disabled>
          </div>

          <div class="update-crop__form-buttons">
            <button type="submit" class="update-crop__button update-crop__button--save">Guardar Cambios</button>
            <a href="visualizar-cultivo.html" class="update-crop__button update-crop__button--cancel">Cancelar</a>
          </div>
        </form>
      </div>
    </main>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const idCultivo = localStorage.getItem("idCultivo");

      if (!idCultivo) {
        alert("No se encontr칩 el ID del cultivo.");
        return;
      }

      try {
        const res = await fetch(`http://localhost:3000/cultivos/${idCultivo}`);
        const cultivo = await res.json();

        document.getElementById("nombreCultivo").value = cultivo.nombre_cultivo || '';
        document.getElementById("tipoCultivo").value = cultivo.tipo_cultivo || '';
        document.getElementById("tamano").value = cultivo.tamano || '';
        document.getElementById("ubicacion").value = cultivo.ubicacion || '';
        document.getElementById("estado").value = cultivo.estado || '';
        document.getElementById("descripcion").value = cultivo.descripcion || '';
        document.getElementById("idCultivoMostrar").value = cultivo.id_cultivo || '';
      } catch (error) {
        alert("Error al cargar los datos del cultivo.");
        console.error(error);
      }

      document.getElementById("formulario-actualizar-cultivo").addEventListener("submit", async (e) => {
        e.preventDefault();

        const datosActualizados = {
          nombre_cultivo: document.getElementById("nombreCultivo").value,
          tipo_cultivo: document.getElementById("tipoCultivo").value,
          tamano: document.getElementById("tamano").value,
          ubicacion: document.getElementById("ubicacion").value,
          estado: document.getElementById("estado").value,
          descripcion: document.getElementById("descripcion").value
        };

        try {
          const res = await fetch(`http://localhost:3000/cultivos/${idCultivo}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(datosActualizados)
          });

          if (res.ok) {
            alert("Cultivo actualizado correctamente.");
            window.location.href = "visualizar-cultivo.html";
          } else {
            alert("Error al actualizar el cultivo.");
          }
        } catch (error) {
          alert("Error al enviar la solicitud.");
          console.error(error);
        }
      });
    });
  </script>
</body>
</html>
