<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Actualizar Ciclo Cultivo</title>
  <link rel="stylesheet" href="/frontend/public/css/pages/actualizar-ciclo-cultivo-style.css" />
</head>
<body>
  <div class="cultivo-container">
    <header class="cultivo-header">
      <img src="/frontend/IMG/logo-sena.png" alt="SENA Logo" class="cultivo-header__logo" />
      <h1 class="cultivo-header__title">Actualizar Ciclo Cultivo</h1>
    </header>

    <main class="cultivo-main">
      <div class="cultivo-content">
        <div class="cultivo-content__image-placeholder">
          <!-- decorativo -->
        </div>

        <form class="cultivo-form" id="formulario-actualizar">
          <div class="cultivo-form__group cultivo-form__group--grid-page">
            <label class="cultivo-form__label">ID Ciclo Cultivo</label>
            <input type="text" class="cultivo-form__input" id="idCiclo" name="id_ciclo" readonly />
          </div>

          <div class="cultivo-form__group cultivo-form__group--grid-page">
            <label class="cultivo-form__label">Nombre Ciclo Cultivo</label>
            <input type="text" class="cultivo-form__input" id="nombreCiclo" name="nombre_ciclo" required />
          </div>

          <div class="cultivo-form__group cultivo-form__group--grid-page">
            <label class="cultivo-form__label">Periodo de siembra</label>
            <input type="text" class="cultivo-form__input" id="periodoSiembra" name="periodo_siembra" required />
          </div>

          <div class="cultivo-form__group cultivo-form__group--grid-page">
            <label class="cultivo-form__label">Novedades</label>
            <input type="text" class="cultivo-form__input" id="novedades" name="novedades" />
          </div>

          <div class="cultivo-form__group cultivo-form__group--grid-page">
            <label class="cultivo-form__label">Descripción Ciclo Cultivo</label>
            <input type="text" class="cultivo-form__input" id="descripcion" name="descripcion" />
          </div>

          <div class="cultivo-form__buttons">
            <button type="submit" class="cultivo-form__btn cultivo-form__btn--save">Guardar Cambios</button>
            <a href="visualizar-ciclo-cultivo.html" class="cultivo-form__btn cultivo-form__btn--cancel">Cancelar</a>
          </div>
        </form>
      </div>
    </main>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
const params = new URLSearchParams(window.location.search);
const idCiclo = params.get("id");

      if (!idCiclo) {
        alert("No se encontró el ID del ciclo.");
        return;
      }

      // 1. Cargar los datos reales
      try {
        const res = await fetch(`http://localhost:3000/ciclo_cultivo/${idCiclo}`);
        const ciclo = await res.json();

        document.getElementById("idCiclo").value = ciclo.id_ciclo;
        document.getElementById("nombreCiclo").value = ciclo.nombre_ciclo;
        document.getElementById("periodoSiembra").value = ciclo.periodo_siembra;
        document.getElementById("novedades").value = ciclo.novedades || '';
        document.getElementById("descripcion").value = ciclo.descripcion || '';
      } catch (error) {
        alert("Error al cargar los datos del ciclo.");
        console.error(error);
      }

      // 2. Actualizar al enviar el formulario
      document.getElementById("formulario-actualizar").addEventListener("submit", async (e) => {
        e.preventDefault();

        const datosActualizados = {
          nombre_ciclo: document.getElementById("nombreCiclo").value,
          periodo_siembra: document.getElementById("periodoSiembra").value,
          novedades: document.getElementById("novedades").value,
          descripcion: document.getElementById("descripcion").value
        };

        try {
          const respuesta = await fetch(`http://localhost:3000/ciclo_cultivo/${idCiclo}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(datosActualizados),
          });

          if (respuesta.ok) {
            alert("Ciclo actualizado correctamente.");
            window.location.href = "visualizar-ciclo-cultivo.html";
          } else {
            alert("Error al actualizar el ciclo.");
          }
        } catch (error) {
          alert("Error al enviar la solicitud.");
          console.error(error);
        }
      });
    });
  </script>
</body>
</html>
